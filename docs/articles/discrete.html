<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classification and discrete predictors • xspliner</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Classification and discrete predictors">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">xspliner</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.0.4</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/xspliner.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/discrete.html">Classification and discrete predictors</a>
    </li>
    <li>
      <a href="../articles/graphics.html">Graphics</a>
    </li>
    <li>
      <a href="../articles/automation.html">Automate your work</a>
    </li>
    <li>
      <a href="../articles/methods.html">Methods and xspliner environment</a>
    </li>
    <li>
      <a href="../articles/extras.html">Extra information about the package</a>
    </li>
    <li>
      <a href="../articles/cases.html">Use cases</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Classification and discrete predictors</h1>
                        <h4 class="author">Krystian Igras</h4>
            
            <h4 class="date">2019-10-05</h4>
      
      
      <div class="hidden name"><code>discrete.Rmd</code></div>

    </div>

    
    
<p>This section describes how to xspliner works when some predictors are discrete, or when we deal with classification model.</p>
<div id="qualitative-predictors" class="section level1">
<h1 class="hasAnchor">
<a href="#qualitative-predictors" class="anchor"></a>Qualitative predictors</h1>
<p>As before let’s explain the approach basing on a random forest model. For this case we use HR_data from breakDown package.</p>
<p>Let’s load the data</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">HR_data &lt;-<span class="st"> </span>breakDown<span class="op">::</span>HR_data</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(HR_data)</a></code></pre></div>
<pre><code>## 'data.frame':    14999 obs. of  10 variables:
##  $ satisfaction_level   : num  0.38 0.8 0.11 0.72 0.37 0.41 0.1 0.92 0.89 0.42 ...
##  $ last_evaluation      : num  0.53 0.86 0.88 0.87 0.52 0.5 0.77 0.85 1 0.53 ...
##  $ number_project       : int  2 5 7 5 2 2 6 5 5 2 ...
##  $ average_montly_hours : int  157 262 272 223 159 153 247 259 224 142 ...
##  $ time_spend_company   : int  3 6 4 5 3 3 4 5 5 3 ...
##  $ Work_accident        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ left                 : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ promotion_last_5years: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ sales                : Factor w/ 10 levels "accounting","hr",..: 8 8 8 8 8 8 8 8 8 8 ...
##  $ salary               : Factor w/ 3 levels "high","low","medium": 2 3 3 2 2 2 2 2 2 2 ...</code></pre>
<p>and build random forest in which we predict <code>average_montly_hours</code> based on <code>last_evaluation</code>, <code>salary</code> and <code>satisfaction_level</code> predictors.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(randomForest)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">model_rf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(average_montly_hours <span class="op">~</span><span class="st"> </span>last_evaluation <span class="op">+</span><span class="st"> </span>salary <span class="op">+</span><span class="st"> </span>satisfaction_level, <span class="dt">data =</span> HR_data)</a></code></pre></div>
<p>We’re going to make some transformation/simplification on <code>salary</code> variable. To do so, we need to transform formula passed into <code>xspline</code> function.</p>
<p>Similarly to continuous variable it is enough to use <code>xf</code> symbol on <code>salary</code> variable, i.e. use formula:</p>
<pre><code>average_monthly_hours ~ last_evaluation + xf(salary) + satisfaction_level</code></pre>
<p>We could use the formula for our final GLM model (then we will use basic parameters for xf), but first let’s learn what changes it does.</p>
<div id="individual-conditional-expectation-for-black-box-model" class="section level2">
<h2 class="hasAnchor">
<a href="#individual-conditional-expectation-for-black-box-model" class="anchor"></a>Individual Conditional Expectation for black box model</h2>
<p>Similarly to continuous variables the first thing we do is to get black box model response on single variable, called <strong>effect</strong>.</p>
<p>For continuous variable we used PD or ALE plots, which was average model response on predictor value. In a discrete case we use Individual Conditional Expectation (ICE). The construction is simple:</p>
<p>In training data we replace all values for selected predictor with one of the factor levels and then we perform predictions on resulting dataset. The action is repeated for all factor levels. As a result we get <span class="math inline">\(n * m\)</span> predicted values, where <span class="math inline">\(n\)</span> is number of observations in original training dataset and <span class="math inline">\(m\)</span> is number of selected factor levels.</p>
<p>For above example (and <code>salary</code> variable), we will get <code>nrow(HR_data) * 3</code> predicted values, as <code>salary</code> has 3 levels.</p>
<p>To generate model ICE xspliner uses <code><a href="https://rdrr.io/pkg/pdp/man/partial.html">pdp::partial(ice = TRUE)</a></code> function. To specify additional options for the response, we may customize the effect parameter for <code>xf</code>, just like it was using xs:</p>
<pre><code>average_monthly_hours ~ last_evaluation + xf(salary, effect = list(...)) + satisfaction_level</code></pre>
<p>Possible parameters are inherited from <code><a href="https://rdrr.io/pkg/pdp/man/partial.html">pdp::partial</a></code> function (except <code>ice</code> that is always TRUE).</p>
<p>How can we use info gathered from above data?</p>
</div>
<div id="merging-similar-groups-with-factormerger" class="section level2">
<h2 class="hasAnchor">
<a href="#merging-similar-groups-with-factormerger" class="anchor"></a>Merging similar groups with factorMerger</h2>
<p>In continuous case, we simplified the effect with spline approximation. The main idea for discrete case is to find out which groups give similar black box model response and merge them into common groups. The final model is built on simpler variables that store some information sourced from black box. As a result the GLM is much easier to interpret (for example we reduce 10-level factor into 3-level one).</p>
<p>How is that implemented in xspliner?</p>
<p>The transformation is based on factorMerger package that “Support Adaptive Post-Hoc Fusing of Groups”.</p>
<p>Merging the groups uses just two functions from the package:</p>
<ul>
<li><code>mergeFactors</code></li>
<li><code>getOptimalPartitionDf</code></li>
</ul>
<p>In order to customize variable transition, just specified (inherited from above functions) parameters inside <code>transition</code> parameter of <code>xf</code> formula symbol. For example to use “fast-adaptive” method for groups merging with optimal partition at GIC statistics value of 4, we set:</p>
<pre><code>xf(salary, transition = list(method = "fast-adaptive", value = 4))</code></pre>
<p>In below example, we will transform <code>salary</code> predictor with cutting of GIC statistics at value = 2. As in continuous case we need to use the formula within <code>xspline</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(xspliner)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">model_xs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/xspline.html">xspline</a></span>(</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  average_montly_hours <span class="op">~</span><span class="st"> </span>last_evaluation <span class="op">+</span><span class="st"> </span><span class="kw">xf</span>(salary, <span class="dt">transition =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">value =</span> <span class="dv">2</span>)) <span class="op">+</span><span class="st"> </span>satisfaction_level,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="dt">model =</span> model_rf</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model_xs)</a></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = average_montly_hours ~ last_evaluation + 
##     xf(salary) + satisfaction_level, family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -137.197   -37.956    -1.425    37.728   129.925  
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         136.0467     2.2213  61.248  &lt; 2e-16 ***
## last_evaluation     100.8673     2.2501  44.828  &lt; 2e-16 ***
## xf(salary)lowmedium  -0.3096     1.3929  -0.222    0.824    
## satisfaction_level  -11.3302     1.5494  -7.312 2.76e-13 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 2199.008)
## 
##     Null deviance: 37409709  on 14998  degrees of freedom
## Residual deviance: 32974127  on 14995  degrees of freedom
## AIC: 158000
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>Checking out the model summary, we can realize that “low” and “medium” values were merged into single level (generating “lowmedium” level).</p>
<p>It can be also found by:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model_xs, <span class="st">"salary"</span>)</a></code></pre></div>
<pre><code>##     orig      pred
## 1   high      high
## 2    low lowmedium
## 3 medium lowmedium</code></pre>
<p>The graphical result if fully sourced from factorMerger. It is enough to run:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/plot_variable_transition.html">plot_variable_transition</a></span>(model_xs, <span class="st">"salary"</span>)</a></code></pre></div>
<p><img src="discrete_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
</div>
<div id="quantitative-predictors" class="section level1">
<h1 class="hasAnchor">
<a href="#quantitative-predictors" class="anchor"></a>Quantitative predictors</h1>
<p>xspliner can work with classification problems as well. As the final GLM model can work only with binary classification, the only limit here is the number of levels for predicted value (equals to 2).</p>
<p>Let’s check below example based on SVM algorithm (<code><a href="https://rdrr.io/pkg/e1071/man/svm.html">e1071::svm</a></code>), and modified iris data.</p>
<p>Preparing data (we drop “setosa” level on Species value):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">iris_data &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(iris[iris<span class="op">$</span>Species <span class="op">!=</span><span class="st"> "setosa"</span>, ])</a></code></pre></div>
<p>Building SVM:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(e1071) </a></code></pre></div>
<pre><code>## Warning: package 'e1071' was built under R version 3.5.2</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(xspliner)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">model_svm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span>(Species <span class="op">~</span><span class="st">  </span>Sepal.Length <span class="op">+</span><span class="st"> </span>Sepal.Width <span class="op">+</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Petal.Width, </a>
<a class="sourceLine" id="cb15-3" data-line-number="3">                 <span class="dt">data =</span> iris_data, <span class="dt">probability =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>When the base model response variable is of class factor (or integer with two unique values) then xspliner automatically detects classification problem. To force specific model response distribution you can set family and link parameters. In this case we can use xspliner in standard way.</p>
<p>As each predictor is continuous variable, let’s transform it with <code>xs</code> usage on standard parameters, and build the model:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">model_xs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/xspline.html">xspline</a></span>(Species <span class="op">~</span><span class="st">  </span><span class="kw">xs</span>(Sepal.Length) <span class="op">+</span><span class="st"> </span><span class="kw">xs</span>(Sepal.Width) <span class="op">+</span><span class="st"> </span><span class="kw">xs</span>(Petal.Length) <span class="op">+</span><span class="st"> </span><span class="kw">xs</span>(Petal.Width),</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">                    <span class="dt">model =</span> model_svm)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model_xs)</a></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Species ~ xs(Sepal.Length) + xs(Sepal.Width) + 
##     xs(Petal.Length) + xs(Petal.Width), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.28620  -0.05596  -0.00260   0.05195   1.72606  
## 
## Coefficients:
##                  Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)       -1.1962     0.8079  -1.481  0.13872   
## xs(Sepal.Length)  11.7176    16.9182   0.693  0.48856   
## xs(Sepal.Width)    7.9140     4.8681   1.626  0.10402   
## xs(Petal.Length)   3.0373     1.2369   2.456  0.01406 * 
## xs(Petal.Width)    3.4507     1.3156   2.623  0.00872 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 138.629  on 99  degrees of freedom
## Residual deviance:  16.424  on 95  degrees of freedom
## AIC: 26.424
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>Simple plot for Petal.Width shows that approximation almost fully covers the PDP.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/plot_variable_transition.html">plot_variable_transition</a></span>(model_xs, <span class="st">"Petal.Width"</span>)</a></code></pre></div>
<p><img src="discrete_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#qualitative-predictors">Qualitative predictors</a><ul class="nav nav-pills nav-stacked">
<li><a href="#individual-conditional-expectation-for-black-box-model">Individual Conditional Expectation for black box model</a></li>
      <li><a href="#merging-similar-groups-with-factormerger">Merging similar groups with factorMerger</a></li>
      </ul>
</li>
      <li><a href="#quantitative-predictors">Quantitative predictors</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="author">
  <p>
    Developed by Krystian Igras, Przemyslaw Biecek.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>

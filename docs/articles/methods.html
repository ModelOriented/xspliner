<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods and xspliner environment • xspliner</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methods and xspliner environment">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">xspliner</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.0.3.9003</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/xspliner.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/automation.html">Automate your work</a>
    </li>
    <li>
      <a href="../articles/cases.html">Use cases</a>
    </li>
    <li>
      <a href="../articles/discrete.html">Classification and discrete predictors</a>
    </li>
    <li>
      <a href="../articles/extras.html">Extra information about the package</a>
    </li>
    <li>
      <a href="../articles/graphics.html">Graphics</a>
    </li>
    <li>
      <a href="../articles/methods.html">Methods and xspliner environment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Methods and xspliner environment</h1>
                        <h4 class="author">Krystian Igras</h4>
            
            <h4 class="date">2019-09-16</h4>
      
      
      <div class="hidden name"><code>methods.Rmd</code></div>

    </div>

    
    
<div id="predict" class="section level1">
<h1 class="hasAnchor">
<a href="#predict" class="anchor"></a>Predict</h1>
<p>As xspliner final model is GLM, predict method is just wrapper of <code><a href="https://www.rdocumentation.org/packages/stats/topics/predict.glm">stats::predict.glm</a></code> function. Let’s see it on the below example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(xspliner)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(randomForest)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>rf_iris &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/randomForest/topics/randomForest">randomForest</a></span>(Petal.Width <span class="op">~</span><span class="st">  </span>Sepal.Length <span class="op">+</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Species, <span class="dt">data =</span> iris)</span>
<span id="cb1-6"><a href="#cb1-6"></a>model_xs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/xspline.html">xspline</a></span>(Petal.Width <span class="op">~</span><span class="st"> </span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="st">  </span>Sepal.Length <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="st">  </span><span class="kw">xs</span>(Petal.Length, <span class="dt">effect =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">grid.resolution =</span> <span class="dv">100</span>), <span class="dt">transition =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">bs =</span> <span class="st">"cr"</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="st">  </span><span class="kw">xf</span>(Species, <span class="dt">transition =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">stat =</span> <span class="st">"loglikelihood"</span>, <span class="dt">value =</span> <span class="dv">-300</span>)),</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="dt">model =</span> rf_iris)</span>
<span id="cb1-11"><a href="#cb1-11"></a>newdata &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="dt">Sepal.Length =</span> <span class="dv">10</span>, </span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="dt">Petal.Length =</span> <span class="dv">2</span>, </span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="dt">Species =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="st">"virginica"</span>, <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(iris<span class="op">$</span>Species)))</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(model_xs, <span class="dt">newdata =</span> newdata)</span></code></pre></div>
<pre><code>##          1 
## -0.4567217</code></pre>
</div>
<div id="print" class="section level1">
<h1 class="hasAnchor">
<a href="#print" class="anchor"></a>Print</h1>
<p>Print method works similarly to the summary. In case of passing just the model, standard <code>print.glm</code> is used.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:  stats::glm(formula = Petal.Width ~ Sepal.Length + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Coefficients:
##                    (Intercept)                    Sepal.Length  
##                       -1.87754                        -0.01153  
##               xs(Petal.Length)  xf(Species)versicolorvirginica  
##                        3.07872                        -0.71312  
## 
## Degrees of Freedom: 149 Total (i.e. Null);  146 Residual
## Null Deviance:       86.57 
## Residual Deviance: 5.15  AIC: -70.07</code></pre>
<div id="predictor-based-print" class="section level2">
<h2 class="hasAnchor">
<a href="#predictor-based-print" class="anchor"></a>Predictor based print</h2>
<p>Summary method allows you to check details about transformation of specific variable.</p>
<p>Standard usage <code><a href="https://www.rdocumentation.org/packages/base/topics/print">print(xspliner_object, variable_name)</a></code></p>
<p><em>Quantitative variable</em></p>
<p>When predictor is the quantitative variable its transition is based on GAM model. For this case print uses standard <code>print.gam</code> method.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(model_xs, <span class="st">"Petal.Length"</span>)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## yhat ~ s(Petal.Length, bs = "cr")
## 
## Estimated degrees of freedom:
## 8.83  total = 9.83 
## 
## GCV score: 0.001770352</code></pre>
<p><em>Qualitative variable</em></p>
<p>In case of qualitative predictor, standard <code>print.factorMerger</code> method is used.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(model_xs, <span class="st">"Species"</span>)</span></code></pre></div>
<pre><code>## Family: gaussian Factor Merger.
## 
## Factor levels were merged in the following order:
## 
##      groupA       groupB                     model   pvalVsFull   pvalVsPrevious
## ---  -----------  --------------------  ----------  -----------  ---------------
## 0                                        -285.9861            1                1
## 1    versicolor   virginica              -299.1545            0                0
## 2    setosa       versicolorvirginica    -361.1629            0                0</code></pre>
</div>
</div>
<div id="plot" class="section level1">
<h1 class="hasAnchor">
<a href="#plot" class="anchor"></a>Plot</h1>
<p>You can see all details in <a href="./graphics.html">graphics</a></p>
</div>
<div id="transition" class="section level1">
<h1 class="hasAnchor">
<a href="#transition" class="anchor"></a>Transition</h1>
<p>Transition method allows you to extract objects used during building transition of variables. There are three possible object types that can be extracted.</p>
<div id="extracting-effect" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-effect" class="anchor"></a>Extracting effect</h2>
<p>Each transition is built on top of the black box response data. For example the default response for quantitative variables is PDP - for qualitative ones ICE.</p>
<p>In order to extract the effect use transition method with <code>type</code> parameter equals to data</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="../reference/transition.html">transition</a></span>(model_xs, <span class="dt">predictor =</span> <span class="st">"Petal.Length"</span>, <span class="dt">type =</span> <span class="st">"data"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span>head</span></code></pre></div>
<pre><code>##   Petal.Length      yhat
## 1     1.000000 0.6987140
## 2     1.059596 0.6987140
## 3     1.119192 0.6987140
## 4     1.178788 0.7026794
## 5     1.238384 0.7048788
## 6     1.297980 0.7069511</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="../reference/transition.html">transition</a></span>(model_xs, <span class="dt">predictor =</span> <span class="st">"Species"</span>, <span class="dt">type =</span> <span class="st">"data"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span>head</span></code></pre></div>
<pre><code>##      Species      yhat yhat.id
## 1     setosa 0.2480749       1
## 2 versicolor 0.6443884       1
## 3  virginica 0.7867783       1
## 4     setosa 0.2113078       2
## 5 versicolor 0.6338912       2
## 6  virginica 0.7780645       2</code></pre>
</div>
<div id="extracting-transition-model" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-transition-model" class="anchor"></a>Extracting transition model</h2>
<p>After we built transition basing on continuity of variable specific model is created. In case of quantitative predictor we build GAM model in order to get spline approximation of effect. In case of qualitative predictor we build factorMerger object and get optimal factor division on that.</p>
<p>To extract the model, use transition method with <code>type = "base"</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw"><a href="../reference/transition.html">transition</a></span>(model_xs, <span class="dt">predictor =</span> <span class="st">"Petal.Length"</span>, <span class="dt">type =</span> <span class="st">"base"</span>)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## yhat ~ s(Petal.Length, bs = "cr")
## 
## Estimated degrees of freedom:
## 8.83  total = 9.83 
## 
## GCV score: 0.001770352</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="../reference/transition.html">transition</a></span>(model_xs, <span class="dt">predictor =</span> <span class="st">"Species"</span>, <span class="dt">type =</span> <span class="st">"base"</span>)</span></code></pre></div>
<pre><code>## Family: gaussian Factor Merger.
## 
## Factor levels were merged in the following order:
## 
##      groupA       groupB                     model   pvalVsFull   pvalVsPrevious
## ---  -----------  --------------------  ----------  -----------  ---------------
## 0                                        -285.9861            1                1
## 1    versicolor   virginica              -299.1545            0                0
## 2    setosa       versicolorvirginica    -361.1629            0                0</code></pre>
</div>
<div id="extracting-transition-function" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-transition-function" class="anchor"></a>Extracting transition function</h2>
<p>The final result of building transition is transformation function, that is used in the final GLM model estimation.</p>
<p>To extract the function just use transition method with <code>type = "function"</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>petal_length_xs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/transition.html">transition</a></span>(model_xs, <span class="dt">predictor =</span> <span class="st">"Petal.Length"</span>, <span class="dt">type =</span> <span class="st">"function"</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dt">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(x, <span class="kw">petal_length_xs</span>(x))</span></code></pre></div>
<p><img src="methods_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>species_xf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/transition.html">transition</a></span>(model_xs, <span class="dt">predictor =</span> <span class="st">"Species"</span>, <span class="dt">type =</span> <span class="st">"function"</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">species_xf</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"setosa"</span>, <span class="st">"versicolor"</span>, <span class="st">"virginica"</span>))</span></code></pre></div>
<pre><code>## [1] setosa              versicolorvirginica versicolorvirginica
## Levels: setosa versicolorvirginica</code></pre>
</div>
</div>
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>Summary method allows you to check the basic model details. See below what possibilities the method to xspliner model offers.</p>
<div id="glm-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#glm-summary" class="anchor"></a>GLM summary</h2>
<p>Standard summary method is just wrapper for <code>summary::glm</code>. In order to use this just type:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_xs)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = Petal.Width ~ Sepal.Length + xs(Petal.Length) + 
##     xf(Species), family = family, data = data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.69193  -0.08324  -0.02278   0.10663   0.50985  
## 
## Coefficients:
##                                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                    -1.87754    0.13893 -13.514  &lt; 2e-16 ***
## Sepal.Length                   -0.01153    0.03626  -0.318    0.751    
## xs(Petal.Length)                3.07872    0.21269  14.475  &lt; 2e-16 ***
## xf(Species)versicolorvirginica -0.71312    0.12710  -5.611 9.81e-08 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 0.03527195)
## 
##     Null deviance: 86.5699  on 149  degrees of freedom
## Residual deviance:  5.1497  on 146  degrees of freedom
## AIC: -70.073
## 
## Number of Fisher Scoring iterations: 2</code></pre>
</div>
<div id="predictor-based-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#predictor-based-summary" class="anchor"></a>Predictor based summary</h2>
<p>Summary method allows you to check details about transformation of specific variable.</p>
<p>Standard usage <code><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary(xspliner_object, variable_name)</a></code></p>
<p><em>Quantitative variable</em></p>
<p>When predictor is quantitative variable its transition is based on GAM model. For this case summary displays summary of that model.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_xs, <span class="st">"Petal.Length"</span>)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## yhat ~ s(Petal.Length, bs = "cr")
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 1.211099   0.003995   303.1   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##                   edf Ref.df     F p-value    
## s(Petal.Length) 8.826  8.991 674.3  &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.984   Deviance explained = 98.5%
## GCV = 0.0017704  Scale est. = 0.0015964  n = 100</code></pre>
<p><em>Qualitative variable</em></p>
<p>In case of qualitative predictor, the method displays data.frame storing information how factors were merged during the transition.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_xs, <span class="st">"Species"</span>)</span></code></pre></div>
<pre><code>##         orig                pred
## 1     setosa              setosa
## 2 versicolor versicolorvirginica
## 3  virginica versicolorvirginica</code></pre>
</div>
<div id="surrogate-vs-black-box-comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#surrogate-vs-black-box-comparison" class="anchor"></a>Surrogate vs Black Box comparison</h2>
<p>Providing <code>model</code> parameter instead of <code>predictor</code>, the summary displays a few statistics that compares original model with surrogate one. All statistics definitions are included in <code>summary.xspline</code> documentation.</p>
<p>Here we show one example for classification model.</p>
<p>For this example we use <code><a href="https://www.rdocumentation.org/packages/ISLR/topics/Default">ISLR::Default</a></code> data and build svm model as black box. The model aims to predict <code>default</code> variable, indicating whether the customer defaulted on their debt.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(xspliner)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(e1071)</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a>data &lt;-<span class="st"> </span>ISLR<span class="op">::</span>Default</span>
<span id="cb26-5"><a href="#cb26-5"></a>default.svm &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/e1071/topics/svm">svm</a></span>(default <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data, <span class="dt">probability =</span> <span class="ot">TRUE</span>)</span>
<span id="cb26-6"><a href="#cb26-6"></a>default.xs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/xspline.html">xspline</a></span>(default <span class="op">~</span><span class="st"> </span>student <span class="op">+</span><span class="st"> </span><span class="kw">xs</span>(balance) <span class="op">+</span><span class="st"> </span><span class="kw">xs</span>(income), <span class="dt">model =</span> default.svm)</span></code></pre></div>
<p>In order to check the summary, we need to specify prediction functions for each model. In this case predictions are probabilities of success:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>prob_svm &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(object, <span class="dt">newdata =</span> newdata, <span class="dt">probability =</span> <span class="ot">TRUE</span>), <span class="st">"probabilities"</span>)[, <span class="dv">2</span>]</span>
<span id="cb27-2"><a href="#cb27-2"></a>prob_xs &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(object, <span class="dt">newdata =</span> newdata, <span class="dt">type =</span> <span class="st">"response"</span>)</span></code></pre></div>
<p>Almost each summary statistic compares models basing on some data.</p>
<p>In this case we’re going to compare models on training data providing:</p>
<ul>
<li>
<code>newdata</code> parameter as training data</li>
<li>
<code>model</code> parameter with black box model</li>
<li>
<code>prediction_funs</code> as a list of prediction functions (for surrogate and original model respectively)</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(default.xs, <span class="dt">model =</span> default.svm, <span class="dt">newdata =</span> data, <span class="dt">prediction_funs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(prob_xs, prob_svm))</span></code></pre></div>
<pre><code>## Models comparison 
##   1 - Max prediction normed-diff:  0.5268109 
##   R^2:  0.9185403</code></pre>
<pre><code>## Setting levels: control = No, case = Yes
## Setting levels: control = No, case = Yes</code></pre>
<pre><code>##   1 - Max ROC diff:  0.8712113 
##   1 - Mean ROC diff:  0.9506292</code></pre>
<p>Another set of statistics is generated for prediction functions that return response levels.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>response_svm &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(object, <span class="dt">newdata =</span> newdata)</span>
<span id="cb32-2"><a href="#cb32-2"></a>response_xs &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) {</span>
<span id="cb32-3"><a href="#cb32-3"></a>  y_levels &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(newdata[[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/environment">environment</a></span>(object)<span class="op">$</span>response]])</span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(y_levels[(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict.glm">predict.glm</a></span>(object, <span class="dt">newdata =</span> newdata, <span class="dt">type =</span> <span class="st">"link"</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>], <span class="dt">levels =</span> y_levels)</span>
<span id="cb32-5"><a href="#cb32-5"></a>}</span></code></pre></div>
<p>And similarly to previous example:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(default.xs, <span class="dt">model =</span> default.svm, <span class="dt">newdata =</span> data, <span class="dt">prediction_funs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(response_xs, response_svm))</span></code></pre></div>
<pre><code>## Models comparison 
##   Mean predictions similarity:  0.9966 
##   ACC Black Box:  0.9719 
##   ACC Surrogate:  0.9729</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#predict">Predict</a></li>
      <li>
<a href="#print">Print</a><ul class="nav nav-pills nav-stacked">
<li><a href="#predictor-based-print">Predictor based print</a></li>
      </ul>
</li>
      <li><a href="#plot">Plot</a></li>
      <li>
<a href="#transition">Transition</a><ul class="nav nav-pills nav-stacked">
<li><a href="#extracting-effect">Extracting effect</a></li>
      <li><a href="#extracting-transition-model">Extracting transition model</a></li>
      <li><a href="#extracting-transition-function">Extracting transition function</a></li>
      </ul>
</li>
      <li>
<a href="#summary">Summary</a><ul class="nav nav-pills nav-stacked">
<li><a href="#glm-summary">GLM summary</a></li>
      <li><a href="#predictor-based-summary">Predictor based summary</a></li>
      <li><a href="#surrogate-vs-black-box-comparison">Surrogate vs Black Box comparison</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="author">
  <p>
    Developed by Krystian Igras, Przemyslaw Biecek.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
